package matching;

import java.util.ArrayList;
import java.util.Collections;
import java.util.List;

import com.pama.SchwachstellenDetektorApplication;

import document.Vulnerability;
import resource.VulnerabilityService;

public class NGram {

	// nGram Algorithm modified from https://stackoverflow.com/a/22441728
	public void generateNGrams(ArrayList<String> nGrams, String str, int n) {

		if (str.length() == n) {
			int counter = 0;
			while (counter < n && counter + n <= str.length()) {
				nGrams.add(str.substring(counter));
				counter++;
			}
			return;
		}

		int counter = 0;
		String gram = "";
		while (counter < n) {
			gram += str.charAt(counter);
			counter++;
		}
		nGrams.add(gram);
		generateNGrams(nGrams, str.substring(1), n);
	}

	// Methode zum Z채hlen der gleichen nGrams innerhalb zweier Strings
	public double compareNGrams(ArrayList<String> nGrams1, ArrayList<String> nGrams2) {

		int similarity = 0;

		for (String string : nGrams1) {
			similarity += Collections.frequency(nGrams2, string);
		}

		return similarity;	// Anzahl der gleichen Silben

	}

	public double nGram(String string1, String string2) {

		ArrayList<String> nGrams1 = new ArrayList<String>();
		ArrayList<String> nGrams2 = new ArrayList<String>();

		// f체ge das Extrazeichen zur Optimierung in beiden Strings hinzu
		string1 = "_" + string1 + "_";
		string2 = "_" + string2 + "_";

		generateNGrams(nGrams1, string1, 3);
		generateNGrams(nGrams2, string2, 3);

		// f체ge alle nGrams in 1 Liste, um Anzahl an gesamten, einzigartigen Silben zu erfahren
		ArrayList<String> mergedNGrams = new ArrayList<String>(nGrams2);
		for (String string : nGrams1) {
			if (!mergedNGrams.contains(string))
				mergedNGrams.add(string);
		}

		// Berechne den Score aus Anzahl gleicher Silben / Anzahl gesamter Silben
		return compareNGrams(nGrams1, nGrams2) / mergedNGrams.size() * 100;
	}

	// Main-Methode f체r Testzwecke
	public static void main(String[] args) {
		NGram ng = new NGram();

		String testString = "Apple Inc.";

		ArrayList<String> strings = new ArrayList<String>();
		strings.add("Apple Inc");
		strings.add("Apple");
		strings.add("Apple Corp.");
		strings.add("Apfel");
		strings.add("Cisco");
		strings.add("Aple");

		for (String string : strings) {
			if (ng.nGram(testString.toLowerCase(), string.toLowerCase()) > 15) {
				System.out.println(string + " " + ng.nGram(testString, string) + "%");
			}
		}

	}

}
