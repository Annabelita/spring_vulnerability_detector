/*
 * Schwachstellen-Objekt
 * 
 * Abgeleitet vom JSONFeed
 * attribute = keys in JSON
 * 
 * TODO: Diskussion in der Gruppe -> Welche attribute brauchen wir? 
 * 
 * Beispielhaft mit ein paar Konstruktoren
 * 
 * Automatisches Erstellen von Getters & Setters: 
 * 1. Attribute markieren, von denen ihr die Getters & Setters wollt
 * 2. links klick -> Source -> Generate Getters and Setters...
 */

package document;

import java.util.Arrays;
import java.util.List;
import java.util.PriorityQueue;
import org.springframework.data.annotation.Id;
import org.springframework.data.mongodb.core.mapping.Document;
import matching.AccuracyVulnerability;

// Name der Collection ist cpe
@Document(collection = "cpe")
public class Vulnerability implements Comparable<Vulnerability> {

	// alle möglichen Variablen aus der JSON Datei
	@Id	// ID als Schlüsselattribut
	public String id;

	public String data_type;
	public String data_format;
	public String data_version;

	public String assigner;
	public String vendor_name;
	public String product_name;
	public String[] version_value;
	public String version;
	public String[] problem_description;
	public String problem_language;

	public String problem_value;

	public String reference_url;
	public String reference_name;
	public String refsource;

	public String tag_url;
	public String tag_name;
	public String tag;

	public String description_language;
	public String description_value;

	public String CVE_data_version;
	public String[] cpe_match; // cpe-Strings
	public String publishDate;
	public String lastModified;

	public int score;
	public List<AccuracyVulnerability> matches;

	// ------ Konstruktor -------
	public Vulnerability() {

	}

	public Vulnerability(String id, String vendor_name) {
		super();
		this.id = id;
		this.vendor_name = vendor_name;
	}

	public Vulnerability(String id, String data_type, String data_format, String data_version, String assigner,
			String vendor_name, String product_name, String[] version_value, String[] problem_description,
			String problem_language, String problem_value, String reference_url, String reference_name,
			String refsource, String tag_url, String tag_name, String tag, String description_language,
			String description_value, String cVE_data_version, String[] cpe_match, String publishDate,
			String lastModified) {
		super();
		this.id = id;
		this.data_type = data_type;
		this.data_format = data_format;
		this.data_version = data_version;
		this.assigner = assigner;
		this.vendor_name = vendor_name;
		this.product_name = product_name;
		this.version_value = version_value;
		this.problem_description = problem_description;
		this.problem_language = problem_language;
		this.problem_value = problem_value;
		this.reference_url = reference_url;
		this.reference_name = reference_name;
		this.refsource = refsource;
		this.tag_url = tag_url;
		this.tag_name = tag_name;
		this.tag = tag;
		this.description_language = description_language;
		this.description_value = description_value;
		CVE_data_version = cVE_data_version;
		this.cpe_match = cpe_match;
		this.publishDate = publishDate;
		this.lastModified = lastModified;
	}

	// ------- Getters & Setters ------
	// zusätzliches Entfernen von Anführungszeichen 
	public String getId() {
		return id;
	}

	public void setId(String id) {
		if (id != null) {
			this.id = id.replace("\"", "");
		}
	}

	public String getData_type() {
		return data_type;
	}

	public void setData_type(String data_type) {
		if (data_type != null) {
			this.data_type = data_type.replace("\"", "");
		}
	}

	public String getData_format() {
		return data_format;
	}

	public void setData_format(String data_format) {
		if (data_format != null) {
			this.data_format = data_format.replace("\"", "");
		}
	}

	public String getData_version() {
		return data_version;
	}

	public void setData_version(String data_version) {
		if (data_version != null) {
			this.data_version = data_version.replace("\"", "");
		}
	}

	public String getVersion() {
		return version;
	}

	public void setVersion(String version) {
		if (version != null) {
			this.version = version.replace("\"", "");
		}
	}

	public String getAssigner() {
		return assigner;
	}

	public void setAssigner(String assigner) {
		if (assigner != null) {
			this.assigner = assigner.replace("\"", "");
		}
	}

	public String getVendor_name() {
		return vendor_name;
	}

	public void setVendor_name(String vendor_name) {
		if (vendor_name != null) {
			this.vendor_name = vendor_name.replace("\"", "");
		}
	}

	public String getProduct_name() {
		return product_name.replace("\"", "");
	}

	public void setProduct_name(String product_name) {
		if (product_name != null) {
			this.product_name = product_name.replace("\"", "");
		}
	}

	public String[] getVersion_value() {
		return version_value;
	}

	public void setVersion_value(String[] version_value) {
		for (String version : version_value) {
			if (version != null) {
				this.version = version.replace("\"", "");
			}
		}
		this.version_value = version_value;
	}

	public String[] getProblem_description() {
		return problem_description;
	}

	public void setProblem_description(String[] problem_description) {
		for (String problem : problem_description) {
			if (problem != null) {
				problem = problem.replace("\"", "");
			}
		}
		this.problem_description = problem_description;
	}

	public String getProblem_language() {
		return problem_language;
	}

	public void setProblem_language(String problem_language) {
		if (problem_language != null) {
			this.problem_language = problem_language.replace("\"", "");
		}
	}

	public String getProblem_value() {
		return problem_value;
	}

	public void setProblem_value(String problem_value) {
		if (problem_value != null) {
			this.problem_value = problem_value.replace("\"", "");
		}
	}

	public String getReference_url() {
		return reference_url;
	}

	public void setReference_url(String reference_url) {
		if (reference_url != null) {
			this.reference_url = reference_url.replace("\"", "");
		}
	}

	public String getReference_name() {
		return reference_name;
	}

	public void setReference_name(String reference_name) {
		if (reference_name != null) {
			this.reference_name = reference_name.replace("\"", "");
		}
	}

	public String getRefsource() {
		return refsource;
	}

	public void setRefsource(String refsource) {
		if (refsource != null) {
			this.refsource = refsource.replace("\"", "");
		}
	}

	public String getTag_url() {
		return tag_url;
	}

	public void setTag_url(String tag_url) {
		if (tag_url != null) {
			this.tag_url = tag_url.replace("\"", "");
		}
	}

	public String getTag_name() {
		return tag_name;
	}

	public void setTag_name(String tag_name) {
		if (tag_name != null) {
			this.tag_name = tag_name.replace("\"", "");
		}
	}

	public String getTag() {
		return tag;
	}

	public void setTag(String tag) {
		if (tag != null) {
			this.tag = tag.replace("\"", "");
		}
	}

	public String getDescription_language() {
		return description_language;
	}

	public void setDescription_language(String description_language) {
		if (description_language != null) {
			this.description_language = description_language.replace("\"", "");
		}
	}

	public String getDescription_value() {
		return description_value;
	}

	public void setDescription_value(String description_value) {
		if (description_value != null) {
			this.description_value = description_value.replace("\"", "");
		}
	}

	public String getCVE_data_version() {
		return CVE_data_version;
	}

	public void setCVE_data_version(String cVE_data_version) {
		if (CVE_data_version != null) {
			this.CVE_data_version = CVE_data_version.replace("\"", "");
		}
	}

	public String[] getCpe_match() {
		return cpe_match;
	}

	public void setCpe_match(String[] cpe_match) {
		for (String cpe : cpe_match) {
			if (cpe != null) {
				cpe = cpe.replace("\"", "");
			}
		}
		this.cpe_match = cpe_match;
	}

	public String getPublishDate() {
		return publishDate;
	}

	public void setPublishDate(String publishDate) {
		if (publishDate != null) {
			this.publishDate = publishDate.replace("\"", "");
		}
	}

	public String getLastModified() {
		return lastModified;
	}

	public void setLastModified(String lastModified) {
		if (lastModified != null) {
			this.lastModified = lastModified.replace("\"", "");
		}
	}

	public int getScore() {
		return score;
	}

	public void setScore(double score) {
		this.score = (int) score;
	}

	public List<AccuracyVulnerability> getMatches() {
		return matches;
	}

	public void setMatches(List<AccuracyVulnerability> matches) {
		this.matches = matches;
	}

	// toString Methode für das korrekte Ausgeben
	@Override
	public String toString() {
		return "{ " + "\"data_type\" : " + data_type + "," + "\"data_format\" : " + data_format + ","
				+ "\"data_version\" : " + data_version + "," + "\"ID\" : " + id + "," + "\"assigner\" : " + assigner
				+ "," + " \"vendor_name\" : " + vendor_name + "," + " \"product_name\" : " + product_name + " "
				+ "\"version_value\" : " + Arrays.toString(version_value) + "," + "\"problem_description\" : "
				+ problem_description + "," + "\"problem_language\" : " + problem_language + ","
				+ "\"problem_value\" : " + problem_value + "," + "\"reference_url\" : " + reference_url + ","
				+ "\"reference_name\" : " + reference_name + "," + "\"refsource\" : " + refsource + ","
				+ "\"tag_url\" : " + tag_url + "," + "\"tag_name\" : " + tag_name + "," + "\"tag\" : " + tag + ","
				+ "\"description_language\" : " + description_language + "," + "\"description_value\" : "
				+ description_value + "," + "\"CVE_data_version\" : " + CVE_data_version + "," + "\"cpe_match\" : "
				+ Arrays.toString(cpe_match) + "," + "\"publishDate\" : " + publishDate + "," + "\"lastModified\" : "
				+ lastModified + "}";

	}

	// für die PriorityQueue
	@Override
	public int compareTo(Vulnerability vul) {
		return Double.compare(vul.score, this.score);
	}

	// Main-Methode für Testzwecke
	public static void main(String arg[]) {
		PriorityQueue<Vulnerability> prioQueue = new PriorityQueue<Vulnerability>();

		Vulnerability vul1 = new Vulnerability();
		Vulnerability vul2 = new Vulnerability();
		Vulnerability vul3 = new Vulnerability();
		Vulnerability vul4 = new Vulnerability();
		Vulnerability vul5 = new Vulnerability();
		Vulnerability vul6 = new Vulnerability();
		Vulnerability vul7 = new Vulnerability();

		vul1.setProduct_name("Apple");
		vul2.setProduct_name("Cisco");
		vul3.setProduct_name("Python");
		vul4.setProduct_name("Microsoft");
		vul5.setProduct_name("Linux");
		vul6.setProduct_name("Windows");
		vul7.setProduct_name("Android");

		vul1.setScore(17);
		vul2.setScore(15);
		vul3.setScore(13);
		vul4.setScore(4);
		vul5.setScore(100);
		vul6.setScore(100);
		vul7.setScore(100);

		prioQueue.add(vul1);
		prioQueue.add(vul2);
		prioQueue.add(vul3);
		prioQueue.add(vul4);

		int numberOfOutputs = 3;
		Vulnerability vulCheck;
		while ((vulCheck = prioQueue.poll()) != null) {

			if (vulCheck.score == 100) {
				numberOfOutputs = 0;
				System.out.println(vulCheck.product_name + " " + vulCheck.score);
				continue;
			} else if (numberOfOutputs == 0 || vulCheck.score < 15) {
				break;
			} else {
				System.out.println(vulCheck.product_name + " " + vulCheck.score);
				numberOfOutputs--;
			}

		}

	}

}